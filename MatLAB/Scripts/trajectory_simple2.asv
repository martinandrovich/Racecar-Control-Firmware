% Tachometer & Accelerometer Logging
disp("Simple Trajectory Test");
disp("Version 1.0.0");

% Variables
boolTurn        = false;
offsetVal       = 10;
speedBrake      = 60;
speedAccelerate = 101;

% Reset variables
tachoVal        = 0;

% Connect to Bluetooth Module
fopen(bmodule);
fprintf('\nConnection established; lets go!\n');

% Set broadcasting mode
UnitController.setBroadcastMode(broadcastModes.Tachometer);
pause(1);


while tachoVal < logDistance*logLaps
    
    disp(tachoVal);
    
    dataBytes = fread(bmodule, 2);
    tachoVal = bitor(bitshift(dataBytes(1), 8), dataBytes(2));
    
    if (tachoVal + offsetVal) == length(dataTacho)
        break;
    end
    
    if dataAcclr(tachoVal + offsetVal) == 1 && ~boolTurn
        boolTurn = true;
        UnitController.setDutyCycle(speedBrake);
        fprintf('\nBreak\nTachometer = %d\n', tachoVal);
    end
    
    if dataAcclr(tachoVal + offsetVal) == 0 && boolTurn
        boolTurn = false;
        UnitController.setDutyCycle(speedAccelerate);
        fprintf('\nAccelerate\nTachometer = %d\n', tachoVal);
    end
    
end

% Stop vehicle & broadcasting
UnitController.setDutyCycle(0);
UnitController.setBroadcastMode(broadcastModes.Disabled);

% Close connection
fclose(bmodule);